CREATE DATABASE Car_DB;
Query OK, 1 row affected (0.001 sec)

USE Car_DB;

CREATE TABLE EMPLOYEE (
       EID CHAR(9) NOT NULL,
       EName VARCHAR(50) NOT NULL,
       EPhone CHAR(10),
       Email VARCHAR(50),
       DoB DATE,
       PRIMARY KEY(EID)
     );

CREATE TABLE BRANCH (
       BranchID CHAR(9) PRIMARY KEY NOT NULL,
       BPhone CHAR(10) NOT NULL,
       City VARCHAR(20),
       State VARCHAR(10),
       ZIP CHAR(12),
       mgrID CHAR(9) NOT NULL,
       CONSTRAINT FK_mgrID FOREIGN KEY (mgrID) REFERENCES EMPLOYEE (EID) ON DELETE CASCADE ON UPDATE CASCADE
     );


ALTER TABLE EMPLOYEE ADD BrID CHAR(9) NOT NULL;


ALTER TABLE EMPLOYEE ADD CONSTRAINT FK_BrID FOREIGN KEY (BrID) REFERENCES BRANCH (BranchID) ON DELETE CASCADE ON UPDATE CASCADE;


CREATE TABLE CAR (
       Price DECIMAL(10,2) CHECK (Price >= 0),
       license_number VARCHAR(50) PRIMARY KEY NOT NULL,
       Make VARCHAR(255),
       Year INT(4),
       Model VARCHAR(255)
     );


CREATE TABLE ASSOCIATED_CAR (
       licenseNum VARCHAR(50) PRIMARY KEY NOT NULL,
       BrID CHAR(9) NOT NULL,
       EmpID CHAR(9) NOT NULL,
       FOREIGN KEY (licenseNum) REFERENCES CAR (license_number) ON DELETE CASCADE ON UPDATE CASCADE,
      FOREIGN KEY (BrID) REFERENCES BRANCH (BranchID) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (EmpID) REFERENCES EMPLOYEE (EID) ON DELETE CASCADE ON UPDATE CASCADE
     );


CREATE TABLE OWNER (
       OwnerID CHAR(9) PRIMARY KEY NOT NULL,
       OwnerName VARCHAR(255)
     );


CREATE TABLE OWNED_CAR (
       licenseNum VARCHAR(50) PRIMARY KEY NOT NULL,
       OwnID CHAR(9) UNIQUE NOT NULL,
       percent_owned DECIMAL (5,2) NOT NULL DEFAULT 0,
       FOREIGN KEY (licenseNum) REFERENCES CAR (license_number) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (OwnID) REFERENCES OWNER (OwnerID) ON DELETE CASCADE ON UPDATE CASCADE,
       CHECK (percent_owned >= 0 AND percent_owned <= 100)
     );


CREATE TABLE INSURANCE (
       InsuranceID CHAR(9) PRIMARY KEY NOT NULL,
       InsDetails VARCHAR(100),
       licenseNum VARCHAR(50) NOT NULL,
       type VARCHAR(50) NOT NULL,
       FOREIGN KEY (licenseNum) REFERENCES CAR (license_number) ON DELETE CASCADE ON UPDATE CASCADE
     );

CREATE TABLE CAR_REGISTRATION (
     licenseNum VARCHAR(50) PRIMARY KEY NOT NULL,
       RegDate DATE,
       RegExDate DATE,
       FOREIGN KEY (licenseNum) REFERENCES CAR (license_number) ON DELETE CASCADE ON UPDATE CASCADE,
       CHECK (RegDate < RegExDate)
     );
